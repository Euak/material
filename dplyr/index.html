<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="pt-br">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Aula 3 - P4H  - Material</title>
    <meta name="generator" content="Hugo 0.22" />

    
    <meta name="description" content="Material do Curso de Programação para Ciências Sociais">
    
    <link rel="canonical" href="../dplyr/">
    
    <meta name="author" content="P4H">
    

    <meta property="og:url" content="/dplyr/">
    <meta property="og:title" content="P4H  - Material">
    <meta property="og:image" content="/logo_r4sc.jpg">
    <meta name="apple-mobile-web-app-title" content="P4H  - Material">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../stylesheets/icons.css">
    <link rel="stylesheet" href="../stylesheets/application.css">
    <link rel="stylesheet" href="../stylesheets/temporary.css">
    <link rel="stylesheet" href="../stylesheets/palettes.css">
    <link rel="stylesheet" href="../stylesheets/prism.css">

    <link rel="stylesheet" href="../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        Aula 3
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/p4hUSP" title="@p4hUSP on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="../" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../logo_r4sc.jpg">
        </div>
      
      <div class="name">
        <strong>P4H  - Material </strong>
        
          <br>
          R4CS/site
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/R4CS/site/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/R4CS/site/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introdução" href="../intro/">
	
	Introdução
</a>



  
</li>



<li>
  
    



<a  title="Gráficos" href="../ggplot2/">
	
	Gráficos
</a>



  
</li>



<li>
  
    



<a class="current" title="Dplyr" href="../dplyr/">
	
	Dplyr
</a>


<ul id="scrollspy">
</ul>


  
</li>



<li>
  
    



<a  title="Wrap Up" href="../wrapup/">
	
	Wrap Up
</a>



  
</li>



<li>
  
    



<a  title="Mapas" href="../mapas/">
	
	Mapas
</a>



  
</li>



<li>
  
    



<a  title="Web Scraping" href="../webscraping/">
	
	Web Scraping
</a>



  
</li>



<li>
  
    



<a  title="SQL" href="../sql/">
	
	SQL
</a>



  
</li>



<li>
  
    



<a  title="Text Mining" href="../textmining/">
	
	Text Mining
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Contatos</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/p4hUSP" target="_blank" title="@p4hUSP no GitHub">
              @p4hUSP no GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/p4hUSP" target="_blank" title="@p4hUSP on Facebook">
              @p4hUSP no Facebook
            </a>
          </li>
          

          
          <li>
            <a href="https://p4husp.herokuapp.com" target="_blank" title="@p4hUSP on Slack">
              @p4hUSP on Slack
            </a>
          </li>
          

          
          <li>
            <a href="mailto:programacao.sociais@gmail.com" title="Nosso E-Email programacao.sociais@gmail.com">
              Envie um E-Mail
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Aula 3 </h1>

			

<h2 id="manipulação-de-dados">Manipulação de dados</h2>

<p>Na aula de hoje, antes de retornar as ferramentas de manipulação de dados iremos entender um pouco melhor sobre tipos de dados e estruturas de dados.</p>

<h1 id="objetos-e-atribuições-i">Objetos e atribuições I</h1>

<p>“To understand computations in R, two slogans are helpful:
• Everything that exists is an object.
• Everything that happens is a function call.&rdquo;
— John Chambers</p>

<p>Dados são guardados dentro de objetos.
Objetos possuem diferentes formas de estruturas os dados. Podemos ter objetos de diferentes tipos:
Vetores
Listas
Dataframes</p>

<p>Objetos podem conter  dados de diferentes tipos, como:
Números
Strings
Fatores</p>

<h4 id="atribuindo-valores-à-variáveis">Atribuindo valores à variáveis (<code>&lt;-</code>)</h4>

<p>Ocorre que os códigos digitados até aqui apenas são executados no console, o que significa que não estamos salvando estes objetos na memória do computador, o que não nos possibilita manipular as estruturas de uma forma mais fácil.</p>

<pre><code class="language-r">1
a &lt;- 1
a
b &lt;- (“Hello, world”)
b
dado &lt;- c(1,2,3,4,5,6)
dado
</code></pre>

<h2 id="tipos-de-dados">Tipos de dados</h2>

<pre><code class="language-r">knitr::include_graphics(&quot;imgs/TipoDeDados.png&quot;)
</code></pre>

<p><img src="imgs/TipoDeDados.png" title="plot of chunk unnamed-chunk-2" alt="plot of chunk unnamed-chunk-2" style="display: block; margin: auto;" /></p>

<h3 id="lidando-com-números">Lidando com números</h3>

<p>O tipo mais comum de dado é o tipo númerico. O número de votos que um candidato recebeu, número de ministérios em cada governo e a taxa de sucesso do Executivo e etc..  Estes valores podem ser classificados em dois tipos: <code>Inteiros</code> e <code>Reais</code>.</p>

<pre><code class="language-r">3 # numero inteiro
</code></pre>

<pre><code class="language-r">55.4 # numero real
</code></pre>

<h3 id="lidando-com-texto">Lidando com texto</h3>

<p>Outro tipo de dado muito conhecido é o tipo texto, ou também chamado strings. Para formarmos um dado do tipo texto basta utilizarmos aspas simples (<code>''</code>) ou aspas duplas (<code>&quot;&quot;</code>), mas lembre-se não podemos intercalar as aspas, como por exemplo, <code>'olá mundo&quot;</code>.</p>

<pre><code class="language-r">&quot;Vargas&quot;
</code></pre>

<pre><code class="language-r">'Janio Quadros'
</code></pre>

<pre><code class="language-r">&quot;1945&quot;
</code></pre>

<p>Perceba que devido ao fato de 1945 estar entre aspas, ele não é mais um dado do tipo número, mas sim texto.</p>

<h3 id="lidando-com-fatores">Lidando com fatores</h3>

<p>Vamos supor que estamos trabalhando com dados de survey e em uma das questões temos a escala likert, em que as respostas vão do &ldquo;Discordo totalmente&rdquo; até o &ldquo;Concordo totalmente&rdquo; contabilizando um total de 6 categorias de resposta. Ocorre que para que o <strong>R</strong> entenda este tipo de dado como algo categórico, precisamos transformá-los em fatores (factors).</p>

<p>Para fazer essa transformação, utilizaremos uma função chamada <code>factor()</code> que recebe como parâmetro um vetor com o que queremos transformar em categorias.</p>

<pre><code class="language-r">factor(c(&quot;Discordo totalmente&quot;, &quot;Discordo parcialmente&quot;, &quot;Indiferente&quot;, &quot;Concordo parcialmente&quot;, &quot;Concordo totalmente&quot;))
</code></pre>

<p>Diferente de quando executamos um dado tipo texto, os dados categóricos apresentam os níveis das categorias (levels). Perceba que as nossas categorias não estão de acordo com o que a escala likert pressupõe e para arrumar este problema, precisamos definir os níveis através de um outro parâmetro da função <code>factor()</code> chamado <code>levels =</code>.</p>

<pre><code class="language-r">factor(c(&quot;Discordo totalmente&quot;, &quot;Discordo parcialmente&quot;, &quot;Indiferente&quot;, &quot;Concordo parcialmente&quot;, &quot;Concordo totalmente&quot;),
       levels = c(&quot;Discordo totalmente&quot;, &quot;Discordo parcialmente&quot;, &quot;Indiferente&quot;, &quot;Concordo parcialmente&quot;, &quot;Concordo totalmente&quot;))
</code></pre>

<p>Pode parecer um pouco confuso agora, mas iremos esclarecer estes pontos nos próximos tópicos.</p>

<h3 id="lidando-com-lógicos-booleanos">Lidando com lógicos/booleanos</h3>

<p>Valores booleanos são resultados de operações booleanas e podem ser definidos como <strong>verdadeiros</strong> ou <strong>falsos</strong>. Por convenção, trabalhamos com os termos em inglês. Portanto, <strong>TRUE</strong> ou <strong>FALSE</strong>.</p>

<p>Por operações booleanas, podemos pensar em diferentes testes que tenham <strong>necessariamente</strong> uma resposta ou verdadeira ou falsa. Por exemplo, 3 é maior do que 1? Verdadeiro! E 3 é menor do que 2? Falso!</p>

<p>Vamos realizar essas duas operações no R.</p>

<pre><code class="language-r"># 3 é maior do que 1?
3 &gt; 1
</code></pre>

<pre><code class="language-r"># 3 é maior do que 1?
3 &lt; 2
</code></pre>

<p>Existem, obviamente, outras operações. É possível também testar a igualdade entre dois valores com <code>==</code>.</p>

<pre><code class="language-r"># 2 é igual a 2?
2 == 2
</code></pre>

<p>Também podemos testar se dois valores são diferentes.</p>

<pre><code class="language-r">#120 é diferente de 20?
120 != 20
</code></pre>

<p>Outras variações utilizadas são o maior ou igual (<code>&gt;=</code>) e o menor ou igual (<code>&lt;=</code>). Além disso, também é possível realizar essas operações com textos.</p>

<pre><code class="language-r"># &quot;harvard&quot; é igual a &quot;MIT&quot;?
&quot;Harvard&quot; == &quot;MIT&quot;
</code></pre>

<p>Não iremos introduzir essa ideia aqui, mas caso seja de interesse também podemos utilizar as noções de maior e menor para textos. Você teria um palpite de como um texto pode ser maior do que outro?</p>

<p>Além disso, o TRUE/FALSE, como veremos adiante, podem ser utilizados em parâmetros de funções, como por exemplo, &ldquo;Você gostaria que ao fazer a média de um conjunto de valores sejam removidos os valores ausentes?&rdquo;. Se você preenche com TRUE, o resultado provavelmente será númerico, caso preencha com FALSE e você tenha dados ausentes, com toda certeza seu resultado será um valor ausente, ou também chamado de missing.</p>

<h3 id="valores-ausentes-missings">Valores ausentes/ missings</h3>

<p>Existem dois tipos de valores missing, o <code>NA</code> (not avaible) e o <code>NaN</code> (not a number), ambos tem sentidos semelhantes, porém o primeiro é mais genérico para cada tipo de dado. Para sabermos se um certo dado é missing, utilizamos a função <code>is.na()</code>.</p>

<pre><code class="language-r">is.na(NA)
is.na(99)
</code></pre>

<h1 id="manipulação-de-bancos-de-dados">Manipulação de bancos de dados</h1>

<p>A manipulação de dados é a parte do trabalho que antecepe a produção de gráfico e a análise dos resultados. Seja se você está utilizando uma base de dados produzida por terceiros ou de produção própria, utilizará ferramentas de manipulação de dados. Tais ferramentas são essenciais para que você consiga obter o resultado final desejado com a sua análise.
Com essas ferramentas você poderá:
- visualizar as informações que o banco fornece, permitindo checagens e pequenas explorações
- criar novas variáveis a partir de variáveis já extistentes no banco.
- modificar a estrutura do banco, seja modificando nome de variáveis, e quais as variáveis são de seu interesse.
- agregar informações de outras bases de dados.</p>

<p>Depois de todo o processso de manipulação, você obterá sua própria base de dados!</p>

<h1 id="por-que-utilizamos-o-pacote-tidyverse-para-manipular-dados">Por que utilizamos o pacote tidyverse para manipular dados?</h1>

<p>Nós que utilizamos a programação sem sermos programadores nos favorecemos com a criação de pacotes como o tidyverse. Esse super pacote abriga dentro de si uma série de outros pacotes (que podem ser utilizados separadamente, mas que poupam muito trabalhando sendo reunidos em um só) que dão conta de todas as etapas do ciclo da ciência de dados.</p>

<ul>
<li><p>Importação (readr, DBI)</p></li>

<li><p>Tidy (tidyr)</p></li>

<li><p>Transformação (dplyr)</p></li>

<li><p>Visualização (ggplot2)</p></li>

<li><p>Modelagem (modelr)</p></li>
</ul>

<p>Nas aulas três e quatro passaremos pela importação, mas nosso foco será a transformação de nossas bases em formato tidy e a manipulação de dados utilizando o dplyr.</p>

<h1 id="começando-pelo-começo">Começando pelo começo</h1>

<p>Para utilizar o tidyverse temos que instalá-lo e habitá-lo em nossos computadores. Então, vamos nessa!</p>

<pre><code class="language-r">install.packages(&quot;tidyverse&quot;)
library(tidyverse)
</code></pre>

<h1 id="tydr-r">Tydr R</h1>

<p>Existem dois conjuntos de pacotes que utilizamos para estruturar bancos de dados</p>

<ul>
<li>1º conjunto: estrutura como as variáveis aparecem</li>
</ul>

<p>Derreter (gather)
Esticar (spread)</p>

<ul>
<li>2º conjunto: permite unir o conteúdo de dois ou mais variáveis</li>
</ul>

<p>Unir (unite)
Separar (separate)</p>

<h1 id="tidyr-parte-1-estruturar-o-seu-banco-de-dados-no-formato-tidy">Tidyr parte 1: Estruturar o seu banco de dados no formato tidy</h1>

<p>Esse primeiro conjunto de variáveisé aquele capaz de realizar modificações estruturais no nosso banco de dados, e antes de explicar o que isso quer dizer vamos comparar duas bases de dados que trazem as mesmas informações, mas com estruturas diferentes para pensarmos no impacto que isso gera sobre a utilização dos funções.</p>

<p>Primeiro, importe esse banco.</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018 &lt;- read_csv(&quot;VOTOS_PRIMEIROTURNO_UF_2018.csv&quot;)
</code></pre>

<p>O que esse banco mostra?
O total de votos que todos os candidatos à presidência obtiveram no primeiro turno da eleição.</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018_2 &lt;- read_csv(&quot;VOTOS_PRIMEIROTURNO_UF_2018_2.csv&quot;)
</code></pre>

<p>Nesse segundo banco, temos a mesma informação. Mas a estrutura do banco está diferente, os estados deixaram de ser representados em uma mesma coluna passando a nomear novas colunas. Qual dos dois bancos seria o ideal para aplicar as ferramentas de manipulação?</p>

<p>Para entender a diferença e saber qual é o melhor, temos que pensar como queremos agregar a informação sobre os estados em nossa análise. A informação sobre os estados é também uma variável que se agrega dentro da variável de UFs, o que quer dizer que quando ela está da forma não tidy, não conseguimos aplicar muitos das funções de manipulação.</p>

<p>O formato da primeira tabela é o que consideramos tidy, esse formato é o ideal para que possamos aplicar os verbos do pacote tidyverse.</p>

<p>Existe um comando que é capaz de realizar ambas as transformações.</p>

<p>Gather:</p>

<p>Caso quereiramos transformar o segundo banco no formato tidy pode usar o comando gather.
Esse comando derrete/agrupa colunas em duas colunas finais</p>

<p>gather(dataframe, intervalos de colunas, key, values)</p>

<p>data = Data frame a ser remodelado
&lsquo;intervalos de colunas&rsquo; = Nomes ou índices numéricos das colunas agrupadas
key = Nome da nova coluna-chave (character string)
value = Nome da nova coluna de valores</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018_tidy &lt;- gather(VOTOS_PRIMEIROTURNO_UF_2018, AC:ZZ, key = &quot;UF&quot;, value = &quot;QTDE_VOTOS&quot;)
</code></pre>

<p>Spread</p>

<p>Com essa função, podemos fazer com que uma das variáveis se transforme em nome das variáveis, ou seja,gera multiplas colunas a partir de duas colunas.</p>

<p>spread(data, key, values)</p>

<p>Data =  dataframe a ser remodelado
key = Coluna para usar para as &lsquo;chaves&rsquo; (nomes das novas colunas)
values = Coluna para usar para os valores (novas células nas colunas)</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018_2_spread &lt;- spread(VOTOS_PRIMEIROTURNO_UF_2018_2, UF, QTDE_VOTOS)
</code></pre>

<h1 id="unite-e-separate">Unite e separate</h1>

<p>Vamos começar pela unite. Essa função permite a criação de uma nova variável formada pelo conteúdo de duas outras delas. Ou seja, ela concatena duas ou mais informações.</p>

<p>Vamos unir então o ano da eleição e o turno.</p>

<p>unite(banco, &ldquo;nova_variavel&rdquo;, primeira_variavel, segunda_variavel, sep = &ldquo; - &ldquo;)</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018_2_unite &lt;- unite(VOTOS_PRIMEIROTURNO_UF_2018_2,&quot;ANO_TURNO&quot;, ANO_ELEICAO, NUM_TURNO, sep = &quot; -&quot; )
</code></pre>

<p>Já a separate que vai fazer o oposto, a partir de uma variável separa em mais variáveis.</p>

<p>separate(banco, variável_criada, into = c(&ldquo;variável_1&rdquo;, &ldquo;variavel_2&rdquo;&ldquo;), sep = &rdquo; - &ldquo;)</p>

<pre><code class="language-r">VOTOS_PRIMEIROTURNO_UF_2018_2_separate &lt;- separate(VOTOS_PRIMEIROTURNO_UF_2018_2_unite, ANO_TURNO, into = c(&quot;ANO&quot;, &quot;TURNO&quot;), sep = &quot; - &quot;)
</code></pre>

<h1 id="dplyr-e-seus-verbos">Dplyr e seus verbos</h1>

<p>Agora que entendemos sobre a estrutura de um banco de dados, vamos começar a explorar as funções que permitem a manipulação de dados. Para isso vamos analisar o banco de dados que originou esse que utilizamos anterior. Nosso objetivo nessas aulas é cpnseguir entender quais a aplicações foram feitas para chegar ao estado das tabelas acima, replicar esse comandos e avançar ainda mais nas possibilidades de manipulação.</p>

<h1 id="rename">Rename</h1>

<p>Esse verbo permite renomear uma variável. Então ela se aplica apenas aos nomes das variáveis.</p>

<p>Vamos utilizar o banco que deu origem aos dois primeiros anteriores. Ou seja, é a quantidade de votos obtidas pelos candidatos à presidência em cada estado da federação no primeiro e no segunda turno.</p>

<p>rename(banco, nome_novo = nome_velho)</p>

<pre><code class="language-r">#Vamos importar o banco completo:

VOTOS_PRESIDENTE_UF_2018 &lt;-read_csv(&quot;VOTOS_PRESIDENTE_UF_2018.csv&quot;)

# Vamos renomear a variável NUMERO_CANDIDATO

VOTOS_PRESIDENTE_UF_2018_rename &lt;- rename(VOTOS_PRESIDENTE_UF_2018, NUM_CANDIDATO = NUMERO_CANDIDATO)
</code></pre>

<h1 id="select">Select</h1>

<p>Essa variável permite a seleção de algumas variáveis entre todas as disponíveis</p>

<p>select(dataframe, variavel_1, variavel_2)</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_select &lt;- select(VOTOS_PRESIDENTE_UF_2018, ANO_ELEICAO, NUM_TURNO, NUMERO_CANDIDATO, QTDE_VOTOS)
</code></pre>

<h1 id="filter">Filter</h1>

<p>Se a função select seleciona as variáveis, agora apresentaremos funções que lidam com as observações das variáveis.</p>

<p>filter(dataframe, variavel == &ldquo;observação&rdquo;)</p>

<p>Dessa forma, podemos fazer uma tabela que contenha apenas resultado de um estado.</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_filter1 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, UF == &quot;SP&quot;)
</code></pre>

<p>Podemos selecionar mais de uma categoria de uma vez usando o sinal de |</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_filter2 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, UF == &quot;SP&quot;| UF == &quot;RJ&quot;| UF == &quot;ES&quot;| UF == &quot;MG&quot;)
</code></pre>

<p>E também observações de diferentes categorias. Nesse caso podemos usar ou uma vírgula ou o sinal &amp;.</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_filter3 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, UF == &quot;SP&quot;, NUM_TURNO == 2)

VOTOS_PRESIDENTE_UF_2018_filter3 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, UF == &quot;SP&quot; &amp; NUM_TURNO == 2)
</code></pre>

<p>Repare a importância sobre a diferença entre os tipos de variáveis e a forma como são representantas. Quanto temos variáveis de tipo texto, devemos usar aspas, diferente de quando temos números.</p>

<p>Podemos usar o filtro para excluir a variável usando o sinal (!=)</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_filter4 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, UF != &quot;SP&quot;)
</code></pre>

<p>A seleção de números é feita de forma um pouco diferente da anterior porque diferente do filtro de variáveis categóricas. Podemos selecionar intervalos de valores com os seguintes operadores: maior (&gt;), maior ou igual (&gt;=), menor (&lt;), menor ou igual (&lt;=).</p>

<p>Vamos selecionar as observações dos estados que obtiveram mais de 1000 votos.</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_filter5 &lt;- filter(VOTOS_PRESIDENTE_UF_2018, QTDE_VOTOS &gt; 1000)
</code></pre>

<h1 id="mutate-criar-uma-nova-variável">Mutate + criar uma nova variável</h1>

<p>O mutate é o verbo usando amplamente dentro das funções do dyplr já que tem o seu sentido é o de produzir mudanças, como a criação de uma nova variável.</p>

<p>Podemos criar uma variável em branco dessa forma.</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_nova1 &lt;- mutate(VOTOS_PRESIDENTE_UF_2018, nova_var = NA)
</code></pre>

<p>Podemos também copiar uma outra variável e fazer operações com ela para resultar em uma nova.</p>

<pre><code class="language-r">VOTOS_PRESIDENTE_UF_2018_nova2 &lt;- mutate(VOTOS_PRESIDENTE_UF_2018, nova_var2 = QTDE_VOTOS-1)
</code></pre>

<p>Mutate() + ifelse</p>

<p>Podemos preencher algum campo que exija alguma condicionalidade. Assim como vimos no exercício da semana passada.</p>

<p>VOTOS_PRESIDENTE_UF_2018 &lt;- mutate(VOTOS_PRESIDENTE_UF_2018, regiao = ifelse(UF == SP, &ldquo;SUDESTE&rdquo;, NA))</p>

<h1 id="count">Count</h1>

<p>A função count() irá contar as categorias de uma variável. Para isso, apresentará os resultados em um dataframe diferendo do dataframe que contém os dados.</p>

<p>Podemos, por exemplo, contar o número de observações por turno.</p>

<p>contar_segundoturno &lt;- count(VOTOS_PRESIDENTE_UF_2018, NUM_TURNO)</p>

<h3 id="group-by-summarise">group_by() + summarise()</h3>

<p>O <code>group_by()</code> e <code>summarise()</code> são funções que trabalham, na maioria das vezes, juntas. Eles servem para sumarizar os dados de acordo com grupos, ou seja, a contagem que haviamos feito com o <code>count()</code> pode ser reproduzida aqui da seguinte forma:</p>

<pre><code class="language-r">temp_1 &lt;- group_by(VOTOS_PRESIDENTE_UF_2018, UF)
summarise(temp_1, Soma = sum())
</code></pre>

<p>O objeto <code>temp_1</code> é uma tabela agrupada! Visualmente ela parece normal, porém qualquer operação feita nela será realizada de acordo com os grupos nos quais ela encontrou, que neste caso é: MAIOR QUE 40 e MENOR QUE 40.</p>

<p>Quando utilizamos o summarise, iremos agrupar as categorias em torno de uma estatística, no caso, a contagem. Para fazer isso, utilizamos a função <code>n()</code>, uma função utilizada para contar obervações. Caso a variável que fossemos sumarizar fosse númerica, poderiamos utilizar a média (<code>mean()</code>), mediana (<code>median()</code>) e assim por diante.</p>

<p>Portanto, a vantagem do <code>group_by()</code> e <code>summarise()</code> é que conseguimos sumarizar com outras estatísticas além da contagem. Vejamos o exemplo abaixo. Estamos agrupando pela categoria de idade e a cor/raça do candidato. Após isto, estamos contando o número de observações que apresentam estas categorias.</p>

<h2 id="toc_22">%&gt;%</h2>

<p>Até então, vimos os principais verbos do <code>dplyr</code>. Para todas as operações realizadas tivemos que criar diversas linhas de código, salvando várias vezes as saídas dentro de um mesmo objeto, algo que é muito trabalhoso.</p>

<p>O Pipe nos permite uma forma diferente de escrever nossos códigos, permitindo que sejam escritos de forma linear, tornando mais clara a forma de reproduzir uma sequência de tarefas.</p>

<p>Ou seja, o pipe permite que emendemos tarefas.</p>

<p>Imagine que queremos saber a média de votos conquistada pelo candidato Meirelles no primeiro turno por estado. Na nossa tabela final queremos apenas a quantidade de votos e os estados.</p>

<p>Novo_banco &lt;- VOTOS_PRESIDENTE_UF_2018 %&gt;%
    filter(variável == observação)%&gt;%
group_by(variável)%&gt;%
summarize(variavel_nova = mean(variavel))%&gt;%
select(variavel_1, variavel_2)</p>

<h1 id="exercícios">Exercícios</h1>

<p>1- nova variável com as regiões
2- crie uma nova variável que contenha a porcentagem de votos obtidas por cada candidato (sem votos brancos e nulos) no segundo turno em cada região.
Atenção que esse exercício requer que realizemos várias operações antes da realização do cálculo.
Tente responder utilizando o pipe</p>


			<aside class="copyright" role="note">
				
				&copy; 2019 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../dplyr/dplyr/" title="Aula 3">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Aula 3
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../textmining/" title="Aula Text Mining">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Aula Text Mining
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '\/';
      var repo_id  = 'R4CS\/site';
    
    </script>

    <script src="../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-119683862-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="../javascripts/prism.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

