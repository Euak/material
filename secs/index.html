<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="pt-br">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>SECS 2018 - P4H  - Material</title>
    <meta name="generator" content="Hugo 0.22" />

    
    <meta name="description" content="Material do Curso de Programação para Ciências Sociais">
    
    <link rel="canonical" href="../secs/">
    
    <meta name="author" content="P4H">
    

    <meta property="og:url" content="/secs/">
    <meta property="og:title" content="P4H  - Material">
    <meta property="og:image" content="/logo_r4sc.jpg">
    <meta name="apple-mobile-web-app-title" content="P4H  - Material">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
    <link rel="stylesheet" href="../stylesheets/icons.css">
    <link rel="stylesheet" href="../stylesheets/application.css">
    <link rel="stylesheet" href="../stylesheets/temporary.css">
    <link rel="stylesheet" href="../stylesheets/palettes.css">
    <link rel="stylesheet" href="../stylesheets/prism.css">

    <link rel="stylesheet" href="../stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <script src="../javascripts/modernizr.js"></script>

    

  </head>
  <body class="palette-primary-red palette-accent-teal">



	
	


<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        SECS 2018
      </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/p4hUSP" title="@p4hUSP on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="../" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="../logo_r4sc.jpg">
        </div>
      
      <div class="name">
        <strong>P4H  - Material </strong>
        
          <br>
          R4CS/site
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            <a href="https://github.com/R4CS/site/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/R4CS/site/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Introdução" href="../intro/">
	
	Introdução
</a>



  
</li>



<li>
  
    



<a  title="Gráficos" href="../ggplot2/">
	
	Gráficos
</a>



  
</li>



<li>
  
    



<a  title="Dplyr" href="../dplyr/">
	
	Dplyr
</a>



  
</li>



<li>
  
    



<a  title="Wrap Up" href="../wrapup/">
	
	Wrap Up
</a>



  
</li>



<li>
  
    



<a  title="Mapas" href="../mapas/">
	
	Mapas
</a>



  
</li>



<li>
  
    



<a  title="Web Scraping" href="../webscraping/">
	
	Web Scraping
</a>



  
</li>



<li>
  
    



<a  title="SQL" href="../sql/">
	
	SQL
</a>



  
</li>



<li>
  
    



<a  title="Text Mining" href="../textmining/">
	
	Text Mining
</a>



  
</li>


        </ul>
        

        
        <hr>
        <span class="section">Contatos</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/p4hUSP" target="_blank" title="@p4hUSP no GitHub">
              @p4hUSP no GitHub
            </a>
          </li>
          

          
          <li>
            <a href="https://facebook.com/p4hUSP" target="_blank" title="@p4hUSP on Facebook">
              @p4hUSP no Facebook
            </a>
          </li>
          

          
          <li>
            <a href="https://p4husp.herokuapp.com" target="_blank" title="@p4hUSP on Slack">
              @p4hUSP on Slack
            </a>
          </li>
          

          
          <li>
            <a href="mailto:programacao.sociais@gmail.com" title="Nosso E-Email programacao.sociais@gmail.com">
              Envie um E-Mail
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>SECS 2018 </h1>

			

<h2 id="1-introdução">1. Introdução</h2>

<p>Os dados estão mais próximos de nós do que imaginamos! Podemos consumi-los de diversas formas e uma delas é para nos auxiliar na tomada de decisão ou entendimento sobre algum fenômeno do nosso cotidiano.</p>

<p>Uma das formas mais comuns de analisar esses dados é por meio da <strong>programação</strong>, instruções que o computador recebe para realizar certas tarefas. Estas &ldquo;instruções&rdquo; são também chamadas de <strong>algoritmos</strong>, uma sequência de passos lógicos até a realização de determinadas ações. Vamos pensar no algoritmo do &ldquo;miojo&rdquo;:</p>

<blockquote>
<p>Passo 1: Tire da embalagem</p>

<p>Passo 2: Aqueça a água</p>

<p>Passo 3: Coloque o miojo na água quente</p>

<p>Passo 4: Adicione o tempero</p>

<p>Passo 5: Sirva!</p>
</blockquote>

<p>Simples, não?</p>

<p>Para que possamos enviar essas instruções para o computador nós precisamos utilizar linguagens que são capazes de ser interpretadas pela máquina e uma delas é o <strong>R</strong>. Mas por que o R?</p>

<ul>
<li><p>O custo de entrada é menor*.</p></li>

<li><p>É de graça.</p></li>

<li><p>Tem uma comunidade enorme.</p></li>
</ul>

<p>Você pode estar se perguntando (ou não) o seguinte: &ldquo;Como assim o custo de entrada é menor? Não é uma linguagem de programação assim como as outras?&rdquo;. Então, sim, o <strong>R</strong> é uma linguagem de programação assim como outras que estão por aí, porém, ao longo dos anos as pessoas desenvolveram muitos <em>pacotes</em> voltados para uma análise de dados de forma mais intuitiva. Por exemplo, hoje em dia, para selecionar/filtrar observações (linhas) de interesse, podemos utilizar uma <em>função</em> chamada <code>filter</code>, que seleciona/filtra apenas as linhas desejadas de acordo com as instruções fornecidas. Antigamente, a única maneira de fazer isso era por meio de um processo mais complicado e menos intuitivo, que exigia uma noção básica de computação. Ainda assim, não se preocupe caso isso tenha parecido confuso. Logo nós iremos utilizá-la junto com outras <em>funções</em> e tudo ficará mais claro.</p>

<h3 id="r-básico">R Básico</h3>

<p>Ok, alguns conceitos apareceram, mas não precisamos ficar assustados. Iremos entende-los com o tempo e com a prática. Para começar a nossa jornada dentro do <strong>R</strong>, vamos nos dedicar a entender as estruturas de dados mais utilizdas dentro dele. Estruturas de dados são maneiras de se guardar informações. No R, embora existam outras, temos duas estruturas de dados muito importantes: os <code>vetores</code> e os <code>data frames</code>.</p>

<p>Um vetor nada mais é do que uma sequência de valores homogêneos. Podemos imaginá-lo como um trem, em que cada vagão corresponde a um valor. Nesse sentido, se quisermos guardar a sequência 1, 2, 3, 4 e 5, o 1 seria nossa locomotiva, seguida de quatro vagões.</p>

<p>Para criar um vetor no <strong>R</strong>, basta utilizar o comando <code>c()</code>. Por exemplo, <code>c(1,2,3,4,5)</code>. Repare que o <strong>c</strong> é minúsculo e que cada valor é separado por vírgulas. Tome cuidado já que qualquer erro de escrita irá resultar em <strong>erro</strong>.</p>

<p>Não se esqueça que é possível colocar <em>strings</em> (textos) como valores de um vetor. Para isso, basta utilizar aspas duplas (&ldquo;&rdquo;) ou simples (&ldquo;). Por exemplo, <code>&quot;Hello World!&quot;</code> ou <code>'Hellor World!'</code></p>

<pre><code class="language-r">c(1,2,3,4,5)

c(5,4,3,2,1)

c(&quot;Hello World!&quot;, &quot;Olá, mundo!&quot;, &quot;Kon'nichiwa sekai!&quot;)
</code></pre>

<p>Por sua vez, <em>data frames</em> são muito semelhantes a planilhas de Excel. Eles são compostos por linhas e colunas. A princípio, nas linhas teremos as nossas observações e, nas colunas, as variáveis. De modo geral, nós iremos transformar sempre os nossos bancos em <em>data frames</em> por meio de algumas funções. É importante você perceber que um <em>data frame</em> nada mais é do que um conjunto de vetores. Cada vetor, nesse caso, é uma coluna de um <em>data frame</em>.</p>

<p>Como criar um <em>data frame</em>? Basta utilizar a função <code>data.frame</code>, que recebe como parâmetro vetores. Vamos tentar reproduzir o <em>data frame</em> acima no R?</p>

<pre><code class="language-r">data.frame(PRODUCTO        = c(&quot;Prod-1&quot;, &quot;Prod-2&quot;, &quot;Prod-3&quot;, &quot;Prod-4&quot;, &quot;Prod-5&quot;, &quot;Prod-6&quot;, &quot;Prod-7&quot;, &quot;Prod-8&quot;, &quot;Prod-9&quot;, &quot;Prod-10&quot;),
           CANTIDAD        = c(&quot;80 kg&quot;, &quot;85 kg&quot;, &quot;90 kg&quot;, &quot;95 kg&quot;, &quot;100 kg&quot;, &quot;105 kg&quot;, &quot;110 kg&quot;, &quot;115 kg&quot;, &quot;120 kg&quot;, &quot;125 kg&quot;),
           PRECIO_UNITARIO = c(50, 50, 49, 49, 48, 48, 47,47, 46, 46))
</code></pre>

<p>Fique tranquilo que dificilmente nós importamos dados na mão para o R. De modo geral, ou iremos raspar os dados da internet (APIs e webscraping) ou iremos importar o nosso banco de um formato muito conhecido, o <strong>.csv</strong>.</p>

<p>Após ter uma noção dessas duas estruturas de dados, podemos avançar em outros dois conceitos muito importantes dentro do R: funções e pacotes. De certo modo, nós já vimos algumas funções. Tanto o <code>data.frame()</code> quanto o <code>c()</code> são funções, isto é, elas executam algum comando. Podemos ler funções como <strong>ações</strong>. Com isso, a função <code>c()</code> pode ser lida como <em>crie um vetor a partir dos seguintes valores</em>. &ldquo;Seguintes valores&rdquo; são para nós os parâmetros dessa função, os <em>inputs</em> ou entradas necessárias para que uma função seja capaz de executar um comando. Resumindo, funções realizam <strong>ações</strong> de acordo <strong>parâmetros</strong>.</p>

<p>Vamos para um outro exemplo. Dentre as diversas funções disponíveis no <strong>R</strong>, existe uma chamada <code>mean()</code>. Como o nome diz, ela calcula a média. Mas qual ou quais parâmetros ela recebe? Para descobrir isso, você pode utilizar o comando <code>?mean</code> no seu console. Vemos que ela recebe um parâmetro <code>x</code> que nada mais é do que um <strong>vetor</strong> contento valores numéricos. Sabendo disso, que tal calcularmos uma média? Qual a média entre 1 e 2? E qual a média entre 1, 2, 3, 4 e 5?</p>

<pre><code class="language-r">mean(c(1,2))

mean(c(1,2,3,4,5))
</code></pre>

<p>Fácil, não? Porém, até agora, nós estamos trabalhando com o <strong>R</strong> de maneira <strong>ineficiente</strong>. Toda vez que realizamos uma operação precisamos escrever os valores na mão. Para evitar repetições, nós normalmente salvamos nossos <strong>objetos</strong> em <strong>nomes</strong>. Para isso, utilizamos a função <code>&lt;-</code> (no RStudio, o atalho é <code>Alt + -</code>). <code>&lt;-</code> é uma função, mas ela opera de maneira diferente. Não é necessário utilizar parênteses ao utilizá-la. Os parâmetros são especificados pelas posições. Do lado esquerdo colocamos o nome do nosso objeto e, do lado direito, o objeto em si. Por exemplo,</p>

<pre><code class="language-r">vetor1 &lt;- c(1,2)

vetor2 &lt;- c(1,2,3,4,5)

dataframe1 &lt;- data.frame(PRODUCTO        = c(&quot;Prod-1&quot;, &quot;Prod-2&quot;, &quot;Prod-3&quot;, &quot;Prod-4&quot;, &quot;Prod-5&quot;, &quot;Prod-6&quot;, &quot;Prod-7&quot;, &quot;Prod-8&quot;, &quot;Prod-9&quot;, &quot;Prod-10&quot;),
                         CANTIDAD        = c(&quot;80 kg&quot;, &quot;85 kg&quot;, &quot;90 kg&quot;, &quot;95 kg&quot;, &quot;100 kg&quot;, &quot;105 kg&quot;, &quot;110 kg&quot;, &quot;115 kg&quot;, &quot;120 kg&quot;, &quot;125 kg&quot;),
                         PRECIO_UNITARIO = c(50, 50, 49, 49, 48, 48, 47,47, 46, 46))
</code></pre>

<p>Pronto nós salvamos os nossos <strong>objetos</strong> em <strong>nomes</strong>. Dessa maneira, podemos chamá-los em outras operações.</p>

<p>Importante ressaltar que o R possui algumas <strong>restrições</strong> para nomes de objetos:</p>

<ol>
<li><p><strong>Não</strong> podem conter como primeiro caractere um número. Logo <code>1oi</code> e <code>93nome</code> não são nomes válidos.</p>

<ul>
<li>Caso o número venha depois de uma letra, não tem problema. Por exemplo, <code>nome123</code> ou <code>teste2</code> são nomes válidos.
<br /></li>
</ul></li>

<li><p><strong>Não</strong> podem conter espaços entre caracteres. Nomes como <code>isso eh um</code> ou <code>nome teste</code> não são válidos.</p>

<ul>
<li>Dica: Substitua o espaço por um <code>_</code> ou por um <code>.</code>.
<br /></li>
</ul></li>

<li><p><strong>Não</strong> podem conter os seguintes símulos: <code>$</code>, <code>@</code>, <code>+</code>, <code>+</code>, <code>/</code>, <code>*</code>.</p></li>

<li><p>Por fim, uma última dica: evite o uso de acentos. Isso pode lhe gerar problemas ao rodar o seu <em>script</em> em outros computadores.</p></li>
</ol>

<p>Essas são as principais regras e dicas ao nomear um objeto no R. Agora, tente executar a função <code>mean</code> com os objetos criados anteriormente.</p>

<pre><code class="language-r">mean(vetor1)

mean(vetor2)

mean(dataframe1$PRECIO_UNITARIO)
</code></pre>

<p>Você entendeu esse comando <code>dataframe1$PRECIO_UNITARIO</code>? Caso tenha ficado confuso, lembre-se que um <em>data frame</em> é um conjunto de vetores, que formam as colunas. Sabendo disso, fica mais fácil entender que o código <code>dataframe1$PRECIO_UNITARIO</code> chamou a coluna <code>PRECIO_UNITARIO</code> do <em>data frame</em> <code>dataframe1</code>, criado por nós anteriormente. Em seguida, a função <code>mean</code> calculou a média dessa coluna.</p>

<p>Existem funções dentro do R para as mais diversas finalidades. Algumas calculam realizam operações simples como calcular a média, a mediana, o desvio padrão. Outras funções nos permitem criar mapas e gráficos. Em geral, grande parte dessas funcionalidades já está implementada no <strong>R</strong> e você não precisa criar uma função para, por exemplo, calcular o coeficiente de regressão linear ou para fazer um gráfico de dispersão. Porém, quando alguém cria uma função ou um conjunto de funções e quer compartilhar com outras pessoas, ela normalmente irá organizar essas funções dentro de um pacote. No <strong>R</strong>, existe uma infinitude de pacotes disponíveis dentro do <strong>CRAN</strong> (repositório oficinal de pacotes no R) e, para instalá-los, basta executar o comando <code>install.packages()</code>, que recebe o nome do pacote como parâmetro.</p>

<pre><code class="language-r">install.packages(&quot;tidyverse&quot;)
</code></pre>

<p>No exemplo acima, instalamos o pacote <code>tidyverse</code>. Após, instalá-lo você precisa carregá-lo dentro do R. Para isso, basta utilizar a função <code>library()</code></p>

<pre><code class="language-r">library(tidyverse)
</code></pre>

<h3 id="fluxo-de-ciência-de-dados-e-organização-da-oficina">Fluxo de Ciência de Dados e Organização da Oficina</h3>

<p>Dentro das ciências de dados, existe um fluxo para se realizar uma análise. Começamos <strong>importando</strong> (<em>1import</em>) os nossos dados para o <strong>R</strong>. Eles podem estar organizados em arquivos .csv, .xlsx, .sav, .dta, entre outros, ou podem estar &ldquo;espalhados&rdquo; em páginas da <em>internet</em>, o que nos levaria ao uso de <strong>webscraping</strong> e APIs. Para esta oficina, iremos apenas importar um banco em <strong>csv</strong>.</p>

<p>Após, nós <strong>estruturamos</strong> (<em>tidy</em>) o nosso banco a fim de facilitar futuras transformações. Normalmente isso envolve deixar o banco de tal maneira que as linhas correspondam a observações e as colunas a variáveis. Não iremos trabalhar com essa etapa hoje uma vez que o nosso banco já se encontra nesse formato.</p>

<p>A terceira etapa (<em>understand</em>) envolve três fases: (1) transformação, (2) visualização e (3) modelagem. No que diz respeito à (1) transformação, nem sempre os nosso banco possui as informações que precisamos. Por exemplo, ao trabalhar com questões raciais, normalmente não utilizamos as classificações do IBGE. É preciso <strong>recodificá-las</strong> para algo que faça mais sentido teórico. Em seguida, podemos (2) visualizar os a distribuição das nossas variáveis de maneira exploratória. Por fim, na (3) modelagem, iremos testar a nossa <strong>hipótese</strong> mediante técnicas estatísticas adequadas. Nesta oficina, iremos dar enfoque apenas para as duas primeiras etapas: transformação e visualização.</p>

<p>Na última etapa, temos a comunicação. Após obter os nosso resultados e interpretar os resultados, precisamos comunicar esses achados para um público. Isso pode ser feito de diferentes maneiras, porém o <strong>R</strong> oferece algumas soluções bastante úteis para isso: <strong>RMarkdown</strong>, <strong>shiny</strong>, entre outras. Infelizmente não teremos tempo para discuti-las, mas incentivamos que você as aprende por conta própria!</p>

<p>Aproveitando que as eleições estão se aproximando, vamos tentar responder algumas perguntas com o <strong>R</strong>?</p>

<h2 id="2-importação-de-dados-readr">2. Importação de Dados (readr)</h2>

<p>O primeiro passo para uma análise é a <strong>importação</strong>. Para isso, iremos utilizar um função do pacote <code>readr</code>, parte do <code>tidyverse</code>. A função <code>read_csv</code> lê um aquivo <strong>csv</strong>, a partir do diretório em que o arquivo se encontra. No nosso caso, o banco de dados está dentro da pasta <strong>data</strong>.</p>

<p>Faça o download do arquivo <a href="https://github.com/R4CS/material/blob/master/tu.secs/data/CANDIDATOS_DEPUTADO_FEDERAL_2014.csv">aqui</a>. Basta clicar em <em>download</em>. Salve o banco dentro da pasta <strong>data</strong> dentro do seu projeto no RStudio.</p>

<pre><code class="language-r">library(tidyverse)

#Leia o arquivo &quot;data/CANDIDATOS_DEPUTADO_FEDERAL_2014.csv&quot; e salve no objeto candidatos
candidatos &lt;- read_csv(&quot;data/CANDIDATOS_DEPUTADO_FEDERAL_2014.csv&quot;, locale = locale(encoding = &quot;UTF-8&quot;))
</code></pre>

<p>Iremos trabalhar com os dados sobre candidatos a deputado federal no ano de 2014. Esse banco possui diversas variáveis sobre o partido pelo qual o candidato concorreu como também algumas características pessoas (raça, gênero, entre outras). Caso queira ter um visão geral do banco, utilze a função <code>glimpse()</code></p>

<pre><code class="language-r">#Dê-me uma visão geral do banco de dados candidatos
glimpse(candidatos)
</code></pre>

<h2 id="3-trasformações-dos-dados-dplyr-e">3. Trasformações dos Dados (dplyr e %&gt;%)</h2>

<p>Com objetivo de realizar as nossas transformações, iremos utilizar o pacote <code>dplyr</code> do <code>tidyverse</code>. A linguagem é bem simples e direta. Por exemplo, <code>filter</code> filtra as nossas observações de acordo com condições desejadas; <code>mutate</code> (dê um google na tradução) altera ou modifica uma variável do nosso banco; e assim por diante. Uma das funções presentes no <code>tidyverse</code> é o <code>%&gt;%</code> (leia-se <em>pipe</em>). Ela é muito importante já que nos permite concatenar funções e, assim, realizar operações de maneira mais eficiente. Você pode ler o <em>pipe</em> como &ldquo;depois&rdquo;. Nos próximos exemplos, iremos incluir uma leitura recomendada da função.</p>

<p>Feita essa apresentação, vamos começar com algumas operações básicas e limpeza do nosso banco.</p>

<p>Uma das variáveis no nosso banco diz respeito a situação de candidatura (DES_SITUACAO_CANDIDATURA). Ela diz se aquele candidato teve uma candidatura deferida ou não.</p>

<p>Uma maneira de ver todas as categorias é com a função <code>count()</code>. Ela literalmente <strong>conta</strong> as categorias presentes em uma variável.</p>

<pre><code class="language-r"># Conte as categorias presentes na variável DES_SITUACAO_CANDIDATURA
# do banco de dados candidatos

candidatos %&gt;%
  count(DES_SITUACAO_CANDIDATURA)
</code></pre>

<p>Repare que existem duas alternativas para candidaturas deferidas: &ldquo;DEFERIDO&rdquo; e &ldquo;DEFERIDO COM RECURSO&rdquo;. A princípio, como o nosso objetivo é trabalhar com os candidatos que de fato concorreram para a câmara federal, vamos filtrar os nossos dados. Iremos selecionar apenas pessoas com candidaturas deferidas. Para isso, existe a função <code>filter()</code>. Ela recebe como parâmetro uma condição lógica, ou seja, no nosso caso, uma igualdade entre as valores que queremos dentro de uma variável.</p>

<pre><code class="language-r"># Filtre a variável DES_SITUACAO_CANDIDATURA para casos de DEFERIDO
# ou DEFERIDO COM RECURSO e sobreponha (&lt;-) o banco de dados candidatos.

candidatos &lt;- candidatos %&gt;%
  filter(DES_SITUACAO_CANDIDATURA %in% c(&quot;DEFERIDO&quot;, &quot;DEFERIDO COM RECURSO&quot;))
</code></pre>

<p>Condições são definidas a partir de alguns operadores lógicos.</p>

<table>
<thead>
<tr>
<th>Descrição</th>
<th align="center">Operador</th>
</tr>
</thead>

<tbody>
<tr>
<td>Igual</td>
<td align="center">==</td>
</tr>

<tr>
<td>Igual a pelo menos 1</td>
<td align="center">%in%</td>
</tr>

<tr>
<td>Diferente</td>
<td align="center">!=</td>
</tr>

<tr>
<td>Maior</td>
<td align="center">&gt;</td>
</tr>

<tr>
<td>Maior ou igual</td>
<td align="center">&gt;=</td>
</tr>

<tr>
<td>Menor</td>
<td align="center">&lt;</td>
</tr>

<tr>
<td>Menor ou igual</td>
<td align="center">&lt;=</td>
</tr>

<tr>
<td>É um <em>missing</em></td>
<td align="center">is.na()</td>
</tr>

<tr>
<td>Não é um <em>missing</em></td>
<td align="center">!is.na()</td>
</tr>
</tbody>
</table>

<p><code>%in%</code> é uma geralização de <code>==</code>. Basicamente, <code>%in%</code> é verdadeiro desde que no mímino um valor do lado direito seja igual a um valor do lado esquerdo. <code>%in%</code> normalmente é utilizado com um <strong>vetor</strong> do lado esquerdo. Caso isso tenha ficado confuso, repare nos exemplos abaixo.</p>

<pre><code class="language-r">&quot;oi&quot; == &quot;oi&quot;

&quot;oi&quot; == &quot;teste&quot;

&quot;oi&quot; %in% c(&quot;teste&quot;, &quot;oi&quot;)

&quot;teste&quot; %in% c(&quot;teste&quot;, &quot;oi&quot;)
</code></pre>

<p>Após organizar a questão das candidaturas, vamos para os resultados da eleição. A variável <code>DESC_SIT_TOT_TURNO</code> diz para nós se o candidato foi eleito ou não e em que modalidade ele foi eleito.</p>

<pre><code class="language-r"># Conte as categorias presentes na variável DESC_SIT_TOT_TURNO
# do banco de dados candidatos

candidatos %&gt;%
  count(DESC_SIT_TOT_TURNO)
</code></pre>

<p>De um lado, temos duas categorias de eleitos: &ldquo;ELEITO POR MÉDIA&rdquo; e &ldquo;ELEITO POR QP&rdquo;. Por outro lado, os não eleitos: &ldquo;NÃO ELEITO&rdquo; e &ldquo;SUPLENTE&rdquo;. Precisamos transformar essa variável mm algo mais interessante para a nossa análise, embora ela possa ter significado em outras perguntas de pesquisa.</p>

<p>A fim de realizar esse tralho, iremos utilizar a função <code>ifelse()</code>. Essa função recebe como <strong>primeiro</strong> parâmetro uma condição, caso a condição seja verdadeira, a função retorna o segundo parâmetro. Se ela for falsa, <code>ifelse()</code> retorna o terceiro parâmetro. No nosso caso, queremos que todas as vezes que DESC_SIT_TOT_TURNO for igual a &ldquo;ELEITO POR MÉDIA&rdquo; ou &ldquo;ELEITO POR QP&rdquo;, <code>ifelse()</code> retorne &ldquo;Eleito&rdquo; senão queremos que ele retorne &ldquo;Não Eleito&rdquo;.</p>

<pre><code class="language-r"># Crie uma nova variável RES_ELEICAO a partir de DESC_SIT_TOT_TURNO.
# Caso DESC_SIT_TOT_TURNO seja igual a &quot;ELEITO POR MÉDIA&quot;, &quot;ELEITO POR QP&quot;
# RES_ELEICAO recebe &quot;Eleito&quot; senão RES_ELEICAO recebe &quot;Não Eleito&quot;.

candidatos &lt;- candidatos %&gt;%
  mutate(RES_ELEICAO = ifelse(DESC_SIT_TOT_TURNO %in% c(&quot;ELEITO POR MÉDIA&quot;, &quot;ELEITO POR QP&quot;), &quot;Eleito&quot;, &quot;Não Eleito&quot;))
</code></pre>

<p>Por fim, nós propomos uma recodificação da variável de cor/raça. Ao invés de trabalhar com as categorias do IBGE, vamos reclassificá-las para algo que tenha mais sentido para cientistas sociais. Optamos por utilizar a classificação &ldquo;brancos&rdquo; e &ldquo;não brancos&rdquo;, sendo esta a união de pessoas que se declaram &ldquo;pretas&rdquo;, &ldquo;pardas&rdquo; ou &ldquo;indígenas&rdquo;.</p>

<pre><code class="language-r"># Conte as categorias presentes na variável DESC_SIT_TOT_TURNO
# do banco de dados candidatos

candidatos %&gt;%
  count(DESCRICAO_COR_RACA)
</code></pre>

<p>Para realizar essa recodificação da variável, vamos utilizar a função <code>case_when()</code>, uma maneira mais simples de trabalhar com mais de uma condição ao mesmo tempo. Sua explicação é semelhante com a que vimos com o <code>ifelse()</code>.</p>

<pre><code class="language-r"># Crie uma nova variável RACA a partir de DESCRICAO_COR_RACA.
# Caso DESCRICAO_COR_RACA seja igual a BRANCA, RACA recebe &quot;Brancos&quot;.
# Caso DESCRICAO_COR_RACA seja igual a INDÍGENA, PARDA ou PRETA, RACA
# recebe &quot;Não Branco&quot;.

candidatos &lt;- candidatos %&gt;%
  mutate(RACA = case_when(DESCRICAO_COR_RACA == &quot;BRANCA&quot;   ~ &quot;Brancos&quot;,
                          DESCRICAO_COR_RACA == &quot;INDÍGENA&quot; ~ &quot;Não Brancos&quot;,
                          DESCRICAO_COR_RACA == &quot;PARDA&quot;    ~ &quot;Não Brancos&quot;,
                          DESCRICAO_COR_RACA == &quot;PRETA&quot;    ~ &quot;Não Brancos&quot;))
</code></pre>

<p>Vamos verificar outras variáveis?</p>

<ul>
<li>DESCRICAO_SEXO</li>
</ul>

<pre><code class="language-r">candidatos %&gt;%
  count(DESCRICAO_SEXO)
</code></pre>

<ul>
<li>DESCRICAO_ESTADO_CIVIL</li>
</ul>

<pre><code class="language-r">candidatos %&gt;%
  count(DESCRICAO_ESTADO_CIVIL)
</code></pre>

<ul>
<li>DESCRICAO_GRAU_INSTRUCAO</li>
</ul>

<pre><code class="language-r">candidatos %&gt;%
  count(DESCRICAO_GRAU_INSTRUCAO)
</code></pre>

<p>Tudo certo? Aparentemente sim!</p>

<p>Que tal olhar algumas curiosidades antes de trabalharmos na visualização dos nossos dados?</p>

<p>Você já se perguntou provavelmente quantas mulheres negras concorrem nas eleições. Avaliar isso com o <code>dplyr</code> é bem fácil. Basta chamar o <code>count</code> com dois parâmetros.</p>

<pre><code class="language-r">candidatos %&gt;%
  count(DESCRICAO_SEXO, DESCRICAO_COR_RACA)
</code></pre>

<p>Uma forma interessante de observamos a tabela acima é transformá-la em uma <em>tabela de contingência</em>. Se você não sabe o que significa essa tabela, temos a definição abaixo:</p>

<blockquote>
<p>A tabela de contingência é a tabela que calcula observações por múltiplas variáveis categóricas. As linhas e colunas das tabelas correspondem a essas variáveis categóricas.</p>
</blockquote>

<p>Para transformar o caso acima em uma tabela de contingência iremos utilizar a função <code>spread()</code>, que irá transformar uma das duas variáveis em coluna. Vamos ver!</p>

<pre><code class="language-r">candidatos %&gt;%
  count(DESCRICAO_SEXO, DESCRICAO_COR_RACA) %&gt;% 
  spread(DESCRICAO_SEXO, n)
</code></pre>

<p>No nosso caso, a variável transformada em coluna foi a <strong>DESCRICAO_SEXO</strong> e os valores que seriam preenchidos em cada coluna criada são os valores contidos em <strong>n</strong>.</p>

<h2 id="4-visualização-dos-dados-ggplot2-e-plotly">4. Visualização dos Dados (ggplot2 e plotly)</h2>

<p>Agora, vamos para uma das coisas mais legais dentro da análise de dados. Após levantar uma pergunta relevante/interessante, o próximo passo é explorar os seus dados e ver se eles estão de acordo com as hipóteses levantadas. Embora existam técnicas bem sofisticadas para esse processo (regressões multivariadas, etc), normalmente nós começamos com algumas visualizações. Dentro do R, há um pacote chamado <strong>ggplot2</strong> criado por Hadley Wickham (um deus do R). Ele é um dos melhores pacotes para criar gráficos dentro do R e relativamente fácil de utilizar.</p>

<pre><code class="language-r">candidatos %&gt;% 
  ggplot(mapping = aes(x = DESCRICAO_SEXO)) +
  geom_bar()
</code></pre>

<p><img src="figures//unnamed-chunk-25-1.png" title="plot of chunk unnamed-chunk-25" alt="plot of chunk unnamed-chunk-25" style="display: block; margin: auto;" /></p>

<pre><code class="language-r">candidatos %&gt;% 
  ggplot(mapping = aes(x = RACA)) +
  geom_bar()
</code></pre>

<p><img src="figures//unnamed-chunk-26-1.png" title="plot of chunk unnamed-chunk-26" alt="plot of chunk unnamed-chunk-26" style="display: block; margin: auto;" /></p>

<p>Substitua o valor de <code>x</code> dentro de <code>aes()</code> por outras variáveis e veja a distribuição.</p>

<p>Uma coisa que me interessa bastante é a diferença de perfis raciais e de gênero entre partidos. Por acaso, existiriam partidos mais brancos e mais masculinos? Existiria o contrário? Partidos com mais mulheres e com mais pessoas não brancas? O que vocês acham?</p>

<pre><code class="language-r">candidatos %&gt;% 
  group_by(SIGLA_PARTIDO) %&gt;% 
  summarise(PROP_MULHERES    = sum(DESCRICAO_SEXO == &quot;FEMININO&quot;)/n(),
            PROP_NAO_BRANCOS = sum(RACA == &quot;Não Brancos&quot;, na.rm = T)/n()) %&gt;% 
  ggplot(mapping = aes(x = PROP_NAO_BRANCOS, y = PROP_MULHERES, label = SIGLA_PARTIDO)) +
  geom_label(alpha = 0.6)
</code></pre>

<p><img src="figures//unnamed-chunk-27-1.png" title="plot of chunk unnamed-chunk-27" alt="plot of chunk unnamed-chunk-27" style="display: block; margin: auto;" /></p>

<p>Muito bacana, não? Se você não sabe, a princípio, as listas de candidatos precisam ter 30% de mulheres. Tendo em vista o gráfico acima, por que não observamos esse padrão em todos os partidos? Será que todos estão fora da lei? Se você olhar o site do <a href="http://www.planalto.gov.br/ccivil_03/leis/l9504.htm">planalto</a>, verá que na verdade essa regra serve tanto para partidos quanto para coligações. Provavelmente, os partidos que estão abaixo da linha realizam coligações e conseguem passar as listas pelo TSE. Nós não iremos investigar isso porque os dados do TSE sobre coligações têm qualidade muito baixa e provavelmente iríamos nos deparar com diversas inconsistências. Fique a vontade para explorar isso em casa e pedir nossa ajuda se precisar.</p>

<p>Bom, vamos voltar para o R! O gráfico acima é meio feio e, como uma parte importante da visualização é a comunicação, seria preciso realizar algumas modificações para ele ficar mais apresentável. Vamos utilizar as seguintes funções para isso <code>labs</code>, e <code>theme_</code>. Baixe e instale o pacote <code>ggthemes</code> também. Ele contém alguns temas bem bonitos para gráficos do <strong>ggplot2</strong>.</p>

<pre><code class="language-r">install.packages(&quot;ggthemes&quot;)
</code></pre>

<pre><code class="language-r">library(ggthemes)

candidatos %&gt;% 
  group_by(SIGLA_PARTIDO) %&gt;% 
  summarise(PROP_MULHERES    = sum(DESCRICAO_SEXO == &quot;FEMININO&quot;)/n(),
            PROP_NAO_BRANCOS = sum(RACA == &quot;Não Brancos&quot;, na.rm = T)/n()) %&gt;% 
  ggplot(mapping = aes(x = PROP_NAO_BRANCOS, y = PROP_MULHERES, label = SIGLA_PARTIDO)) +
  geom_label(alpha = 0.6) +
  theme_calc() +
  labs(x = &quot;Proporção de Não Brancos&quot;,
       y = &quot;Proporção de Mulheres&quot;,
       title = &quot;Perfil dos Candidatos a Deputado Federal&quot;,
       caption = &quot;Fonte: TSE&quot;)
</code></pre>

<p><img src="figures//unnamed-chunk-29-1.png" title="plot of chunk unnamed-chunk-29" alt="plot of chunk unnamed-chunk-29" style="display: block; margin: auto;" /></p>

<p>Substitua <code>theme_calc</code> por outros e veja qual o melhor para você.</p>

<p>Você deve ter reparado que para montar um gráfico com o <em>ggplot2</em> utilizamos o símbolo de <code>+</code> entre as funções. Isso acontece porque o <em>ggplot2</em> foi criado em um esquema de &ldquo;building blocks&rdquo;, isto é, adicionamos camadas (também chamas de <em>layers</em>) de interesse até formar o gráfico que queremos. Existem muitas camadas, porém costumamos generalizá-las da seguinte forma:</p>

<pre><code class="language-r">knitr::include_graphics(&quot;img/layers.png&quot;)
</code></pre>

<h2 id="5-comunicação-r-markdown">5. Comunicação (R Markdown)</h2>

<p>Tendo em vista o fluxo da ciência de dados, o último passo é comunicar os nossos achados. Isso pode ser feito de diversas maneiras. Contudo, ao utilizar o R, nós temos o <code>RMarkdown</code>. Para quem já utilizou <code>markdown</code> ou LaTeX, a ideia é bem parecida. A preocupação será principalmente com o conteúdo e deixaremos a diagramação com os padrões utilizados pelo <code>RMarkdown</code> ou por um <em>template</em> previamente escolhido.</p>

<p>Para ver alguns exemplos <a href="https://rmarkdown.rstudio.com/gallery.html">clique aqui</a></p>

<h2 id="6-extra-mapas">6. EXTRA Mapas</h2>

<p>Que tal explorar os seus dados espacialmente? Para isso, iremos utilizar três pacotes: <code>sf</code> (simple features) e o <code>ggplot2</code> (versão de desenvolvedor), <code>mapproj</code> (para mapas interativos). Execute os comandos abaixo. Fique atento que provavelmente você terá que instalar o pacote de desenvolvedor do <strong>R</strong> e isso demora um pouco. A fim de facilitar a nossa vida, iremos utilizar o pacote <code>brmap</code> para baixarmos os polígonos do Brasil.</p>

<pre><code class="language-r">install.packages(c(&quot;sf&quot;, &quot;mapview&quot;, &quot;devtools&quot;))
devtools::install_github(&quot;tidyverse/ggplot2&quot;)
devtools::install_github(&quot;italocegatta/brmap&quot;)
</code></pre>

<p>Carregue os pacotes.</p>

<pre><code class="language-r">library(sf)
library(mapview)
library(ggplot2)
library(brmap)
</code></pre>

<pre><code>## Error in library(brmap): there is no package called 'brmap'
</code></pre>

<p>Carregue os polígonos de estados e salve em um objeto.</p>

<pre><code class="language-r">estados &lt;- brmap_estado
</code></pre>

<pre><code>## Error in eval(expr, envir, enclos): object 'brmap_estado' not found
</code></pre>

<p>Podemos começar <em>plotando</em> o mapa do Brasil, subdividido em Estados. Normalmente, nós utilizamos o <code>theme_map</code> do pacote <code>ggthemes</code> para criar mapas.</p>

<pre><code class="language-r">estados %&gt;% 
  ggplot() +
  geom_sf() +
  theme_map()
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados' not found
</code></pre>

<p>Muito bonito, não? Agora precisamos fazer uma pergunta interessante para ser avaliada espacialmente. Que tal avaliar quais estados possuem mais mulheres como candidatas?</p>

<pre><code class="language-r">candidatos_uf &lt;- candidatos %&gt;% 
  group_by(SIGLA_UF) %&gt;% 
  summarise(PROP_MULHERES = sum(DESCRICAO_SEXO == &quot;FEMININO&quot;)/n())

estados &lt;- estados %&gt;% 
  rename(SIGLA_UF = estado_sigla)
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados' not found
</code></pre>

<pre><code class="language-r">estados_gen &lt;- estados %&gt;% 
  left_join(candidatos_uf)
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados' not found
</code></pre>

<pre><code class="language-r">estados_gen%&gt;% 
  ggplot(mapping = aes(fill = PROP_MULHERES)) +
  geom_sf(color = &quot;white&quot;)
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados_gen' not found
</code></pre>

<pre><code class="language-r">estados_gen%&gt;% 
  ggplot(mapping = aes(fill = PROP_MULHERES)) +
  geom_sf(color = &quot;white&quot;) +
  coord_sf(datum = NA) + #Remove as linhas
  theme_map() +
  labs(fill    = &quot;Proporção&quot;,
       title   = &quot;Proporção de Mulheres Candidatas por UF&quot;,
       caption = &quot;Fonte: TSE&quot;)
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados_gen' not found
</code></pre>

<p>Você pode testar coisas parecidas para outras variáveis ou realmente cair de cabeça na ciência política e explorar uma das diversas hipóteses discutidas por aí sobre dependência espacial do voto. Não iremos seguir esse caminho já que envolveria uma limpeza mais cuidadosa dos dados e outras dificuldades que necessitariam mais paciência.</p>

<p>Por fim, que tal colocar o seu mapa de modo interativo? Um mapa já chama atenção, mas imagine se o seu usuário pudesse dar zoom, clicar e navegar pelo mapa de maneira semelhante a um <em>google maps</em>. Para fazer isso no R, é muito fácil! Basta utilizar o <code>mapproj</code>.</p>

<pre><code class="language-r">estados_gen %&gt;% 
  mapview(zcol      = &quot;PROP_MULHERES&quot;,
          map.types = &quot;OpenStreetMap&quot;,
          legend    = T)
</code></pre>

<pre><code>## Error in eval(lhs, parent, parent): object 'estados_gen' not found
</code></pre>

<p>Muito legal, não? Eu sinceramente gosto muito de coisas interativas. Confesso que talvez essa visualização em especial não seja muito interessante de ser colocada em um mapa interativo. Porém, imagine se estivéssemos trabalhando com municípios ou com todos os países!</p>

<p>Para quem tiver mais interesse, recomendo aprender mais sobre <code>leaflet</code>, <code>plotly</code> e <code>shiny</code>. São dois pacotes básicos para quem gosta de utilizar gráficos e interativos.</p>


			<aside class="copyright" role="note">
				
				&copy; 2019 Released under the MIT license &ndash;
				
				Documentation built with
				<a href="https://www.gohugo.io" target="_blank">Hugo</a>
				using the
				<a href="http://github.com/digitalcraftsman/hugo-material-docs" target="_blank">Material</a> theme.
			</aside>

			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="../intro/" title="Introdução">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Introdução
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="../sql/" title="SQL">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              SQL
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '\/';
      var repo_id  = 'R4CS\/site';
    
    </script>

    <script src="../javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;

            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }


        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    
      <script>
        (function(i,s,o,g,r,a,m){
          i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||
          []).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;
          m.parentNode.insertBefore(a,m)
        })(window, document,
          'script', '//www.google-analytics.com/analytics.js', 'ga');
         
        ga('create', 'UA-119683862-1', 'auto');
        ga('set', 'anonymizeIp', true);
        ga('send', 'pageview');
         
        var buttons = document.querySelectorAll('a');
        Array.prototype.map.call(buttons, function(item) {
          if (item.host != document.location.host) {
            item.addEventListener('click', function() {
              var action = item.getAttribute('data-action') || 'follow';
              ga('send', 'event', 'outbound', action, item.href);
            });
          }
        });
         
        var query = document.querySelector('.query');
        query.addEventListener('blur', function() {
          if (this.value) {
            var path = document.location.pathname;
            ga('send', 'pageview', path + '?q=' + this.value);
          }
        });
      </script>
    

    <script src="../javascripts/prism.js"></script>

    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

